<html>
	<head>
		<!-- Include Our WebGL JS file -->
		<script src="WebGL.js" type="text/javascript"></script>
		<script>
		
			var GL; 
			var Bird;
			var Canvas2D;
			var speed = 2;
			var turnSpeed = 5.0;
			
			function Ready(){
				GL = new WebGL("GLCanvas", "FragmentShader", "VertexShader");
				LoadModel("Bird", function(VerticeMap, Triangles, TextureMap, NormalsMap){
					if(NormalsMap.length > 0)
					{
						Bird = new GLObject(VerticeMap, Triangles, TextureMap, "Bird.jpg", NormalsMap);
					}
					else
					{
						Bird = new GLObject(VerticeMap, Triangles, TextureMap, "Bird.jpg", false);
					}
					Bird.Pos.Z = 250;
					Bird.Scale.X = 15;
					Bird.Scale.Y = 15;
					Bird.Scale.Z = 15;
					setInterval(Update, 33);
					document.onkeydown = handleKeyDown;
				});
				Canvas2D = document.getElementById("2DCanvas").getContext("2d");
				Canvas2D.fillStyle="#000";

			}
			function handleKeyDown(event){
				//You can uncomment the next line to find out what keycode goes to which key
				//alert(event.keyCode);
				
				if(event.keyCode == 65)
				{
					//Left
					Bird.Rotation.Y += turnSpeed;
				}
				else if(event.keyCode == 68)
				{
					//Right
					Bird.Rotation.Y -= turnSpeed;
				}
				else if(event.keyCode == 83)
				{
					//Forward
					Bird.Pos.X += speed * Math.cos(Bird.Rotation.Y * Math.PI / 180);
					Bird.Pos.Z += speed * Math.sin(Bird.Rotation.Y * Math.PI / 180);
				}
			}
			function Update(){
					Bird.Pos.X += speed * Math.cos(Bird.Rotation.Y * Math.PI / 180);
					Bird.Pos.Z += speed * Math.sin(Bird.Rotation.Y * Math.PI / 180);
				if(Bird.Pos.X > 150 || Bird.Pos.X < -150 || Bird.Pos.Z > 500 || Bird.Pos.Z < 200){
					Bird.Rotation.Y += 5;
					turnSpeed = 0;
					Bird.Pos.X += 1.5 * Math.cos(Bird.Rotation.Y * Math.PI / 180);
					Bird.Pos.Z += 1.5 * Math.sin(Bird.Rotation.Y * Math.PI / 180);
				}
				else{
					turnSpeed = 5.0;
				}
				//Clear the Canvas from the previous draw
				Canvas2D.clearRect(0, 0, 600, 400);
				
				//Title Text
				Canvas2D.font="25px sans-serif";
				Canvas2D.fillText("Bird" , 20, 30);
				
				//Object's Properties
				Canvas2D.font="16px sans-serif";
				Canvas2D.fillText("X : " + Bird.Pos.X , 20, 55);
				Canvas2D.fillText("Y : " + Bird.Pos.Y , 20, 75);
				Canvas2D.fillText("Z : " + Bird.Pos.Z , 20, 95);
				Canvas2D.fillText("Rotation : " + Math.floor(Bird.Rotation.Y) , 20, 115);
				
				GL.GL.clear(16384 | 256);
				GL.Draw(Bird);
			}
			
		</script>
	</head>
	<body onload="Ready()">  
	  <canvas id="GLCanvas" width="1200" height="800" style="position:absolute; top:0px; left:0px;">  
	    	Your Browser Doesn't Support HTML5's Canvas.  
	  </canvas>  
	  
	  <canvas id="2DCanvas" width="1200" height="800" style="position:absolute; top:0px; left:0px;">
	  		Your Browser Doesn't Support HTML5's Canvas.
	  </canvas>
	  
	

	  
	  
	<script id="VertexShader" type="x-shader/x-vertex">  
  
		attribute highp vec3 VertexPosition;
		attribute highp vec2 TextureCoord;
		attribute highp vec3 VertexNormal;
		
		
		uniform highp mat4 TransformationMatrix;
		uniform highp mat4 PerspectiveMatrix;
		uniform highp mat4 NormalTransformation;
		
		uniform bool UseLights;
		
		varying highp vec2 vTextureCoord;
		varying highp vec3 vLightLevel;
		
 		
		void main(void) {
			gl_Position = PerspectiveMatrix * TransformationMatrix * vec4(VertexPosition, 1.0);
			vTextureCoord = TextureCoord;
			
			if(UseLights)
			{
				highp vec3 LightColor = vec3(0.15, 0.15, 0.15);
				highp vec3 LightDirection = vec3(0.5, 0.5, 4);
				highp vec4 Normal = NormalTransformation * vec4(VertexNormal, 1.0);
				
				highp float FinalDirection = max(dot(Normal.xyz, LightDirection), 0.0);
				
				vLightLevel = (FinalDirection * LightColor);
			}
			else
			{	
				vLightLevel = vec3(1.0, 1.0, 1.0);
			}
			
		}
	</script>  
	
	<script id="FragmentShader" type="x-shader/x-fragment">  
		varying highp vec2 vTextureCoord;
		varying highp vec3 vLightLevel;
		
		uniform sampler2D uSampler;
		
		void main(void) {
			highp vec4 texelColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));
			gl_FragColor = vec4(texelColor.rgb * vLightLevel, texelColor.a);
		}     
	</script>  
	
	</body>
</html>